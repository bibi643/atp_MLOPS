#!/bin/bash


## image will be named atp_api_image:latest

docker container run --rm --name api_container -it atp_image:latest

##create the different volumes



docker volume create --name data_volume && docker volume create --name model_volume && docker volume create --name user_admin_volume


docker volume inspect data_volume
docker volume inspect model_volume
docker volume inspect user_admin_volume

## we can see the location of the different volumes
##they should be there

#/var/lib/docker/volumes/data_volume/_data
#Response:    {
        "CreatedAt": "2023-11-29T15:40:03+01:00",
        "Driver": "local",
        "Labels": null,
       "Mountpoint": "/var/snap/docker/common/var-lib-docker/volumes/data_volume/_data",
       "Name": "data_volume",
        "Options": null,
        "Scope": "local"
}
/var/lib/docker/volumes/model_volume/_data
/var/lib/docker/volumes/user_admin_volume/_data



##mount a volume on a container
docker container run -it --name api_container\
 --mount type=volume,src=data_volume,dst=/home/data_folder\
 --mount type=volume,src=model_volume,dst=/home/model_folder\
 --mount type=volume,src=user_admin_volume,dst=/home/user_admin_folder\
 --rm atp_image:latest bash


##Une fois dans le container si on ls le contenu de home on peut voir les differents folders qui sont les poitns de monture

##On va envoyer dans les volumes les fichers que l on a dans le container.


~/Desktop/Mlops_projectDocker/src$ sudo cp -R model /var/snap/docker/common/var-lib-docker/volumes/model_volume/_data/model
~/Desktop/Mlops_projectDocker/src$ sudo cp -R data /var/snap/docker/common/var-lib-docker/volumes/data_volume/_data/data
~/Desktop/Mlops_projectDocker/src$ sudo cp -R user_admin /var/snap/docker/common/var-lib-docker/volumes/user_admin_volume/_data/user_admin






##The following is filling the volumes from the containers and I can't for now.



##volume_data
/ATP_API/src/data_bases.py > /home/data_folder/_data/data_bases.py
/ATP_API/src/data_loader.py > /home/data_folder/_data/data_loader.py
/ATP_API/src/preprocessing.py > /home/data_folder/_data/preprocessing.py
/ATP_API/src/atp_data.csv > /home/data_folder/_data/atp_data.csv



##model

/ATP_API/src/feature_eng.py > /home/model_folder/_data/feature_eng.py
/ATP_API/src/utile.py > /home/model_folder/_data/utile.py
/ATP_API/src/data_loader.py > /home/model_folder/_data/data_loader.py
/ATP_API/src/preprocessing.py > /home/model_folder/_data/preprocessing.py

/ATP_API/src/atp_logistic_model.joblib > /home/model_folder/_data/atp_logistic_model.joblib
/ATP_API/src/atp_logistic_model.pkl > /home/model_folder/_data/atp_logistic_model.pkl
/ATP_API/src/preprocessor_pipeline.pkl > /home/model_folder/_data/preprocessor_pipeline.pkl

/ATP_API/src/modele_predict.py > /home/model_folder/_data/modele_predict.py
/ATP_API/src/model_save.py > /home/model_folder/_data/model_save.py
/ATP_API/src/modele_training.py > /home/model_folder/_data/modele_training.py
/ATP_API/src/modele.py > /home/model_folder/_data/modele.py
/ATP_API/src/new_game_prep.py > /home/model_folder/_data/new_game_prep.py






### USER AND ADMIN

/ATP_API/src/admin_func.py > /home/user_admin_folder/_data/admin_func.py
/ATP_API/src/user_func.py > /home/user_admin_folder/_data/user_func.py



